/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. */package com.example.fptacademysystem.services;import com.example.fptacademysystem.dto.ImportSubjectDTO;import org.springframework.stereotype.Service;import java.io.IOException;import java.io.InputStream;import java.math.BigDecimal;import java.util.ArrayList;import java.util.Iterator;import java.util.List;import org.apache.poi.hssf.usermodel.HSSFWorkbook;import org.apache.poi.ss.usermodel.Cell;import org.apache.poi.ss.usermodel.CellType;import org.apache.poi.ss.usermodel.FormulaEvaluator;import org.apache.poi.ss.usermodel.Row;import org.apache.poi.ss.usermodel.Sheet;import org.apache.poi.ss.usermodel.Workbook;import org.apache.poi.xssf.usermodel.XSSFWorkbook;import org.springframework.web.multipart.MultipartFile;/** * * @author ADMIN */@Servicepublic class ReadExcelCourse {    public static final int COLUMN_INDEX_BRANCHNM = 1;    public static final int COLUMN_INDEX_COURSENAME = 2;    public static final int COLUMN_INDEX_SUBJECTNAME = 3;    public static final int COLUMN_INDEX_SUBJECTSHORTNAME = 4;    public static final int COLUMN_INDEX_SEMID = 5;    public static final int COLUMN_INDEX_SLOT = 6;    public static final int COLUMN_INDEX_FEE = 7;    public List<ImportSubjectDTO> showDataExcel(MultipartFile filePath) throws IOException {        //final String excelFilePath = filePath;        final List<ImportSubjectDTO> books = readExcel(filePath);        return books;    }    public static List<ImportSubjectDTO> readExcel(MultipartFile excelFilePath) throws IOException {        List<ImportSubjectDTO> listS = new ArrayList<>();        // Get file        //InputStream inputStream = new FileInputStream(new File(ex));        // Get workbook        Workbook workbook = getWorkbook(excelFilePath.getInputStream(), excelFilePath.getOriginalFilename());        // Get sheet        Sheet sheet = workbook.getSheetAt(0);        // Get all rows        Iterator<Row> iterator = sheet.iterator();        while (iterator.hasNext())        {            Row nextRow = iterator.next();            if (nextRow.getRowNum() == 0)            {                // Ignore header                continue;            }            // Get all cells            Iterator<Cell> cellIterator = nextRow.cellIterator();            // Read cells and set value for book object            ImportSubjectDTO s = new ImportSubjectDTO();            while (cellIterator.hasNext())            {                //Read cell                Cell cell = cellIterator.next();                Object cellValue = getCellValue(cell);                if (cellValue == null || cellValue.toString().isEmpty())                {                    continue;                }                // Set value for book object                int columnIndex = cell.getColumnIndex();                switch (columnIndex)                {                    case COLUMN_INDEX_BRANCHNM:                        s.setBranchname((String) getCellValue(cell));                        break;                    case COLUMN_INDEX_COURSENAME:                        s.setCoursename((String) getCellValue(cell));                        break;                    case COLUMN_INDEX_SUBJECTNAME:                        s.setSubjectname((String) getCellValue(cell));                        break;                    case COLUMN_INDEX_SUBJECTSHORTNAME:                        s.setSubjectshortname((String) getCellValue(cell));                        break;                    case COLUMN_INDEX_SEMID:                        s.setSemid(new BigDecimal((double) cellValue).intValue());                        break;                    case COLUMN_INDEX_SLOT:                        s.setSlot(new BigDecimal((double) cellValue).intValue());                        break;                    case COLUMN_INDEX_FEE:                        s.setFee(new BigDecimal((double) cellValue).intValue());                        break;                    default:                        break;                }            }            listS.add(s);        }        workbook.close();        return listS;    }    // Get Workbook    private static Workbook getWorkbook(InputStream inputStream, String excelFilePath) throws IOException {        Workbook workbook = null;        if (excelFilePath.endsWith("xlsx"))        {            workbook = new XSSFWorkbook(inputStream);        } else if (excelFilePath.endsWith("xls"))        {            workbook = new HSSFWorkbook(inputStream);        } else        {            throw new IllegalArgumentException("The specified file is not Excel file");        }        return workbook;    }    // Get cell value    private static Object getCellValue(Cell cell) {        CellType cellType = cell.getCellTypeEnum();        Object cellValue = null;        switch (cellType)        {            case BOOLEAN:                cellValue = cell.getBooleanCellValue();                break;            case FORMULA:                Workbook workbook = cell.getSheet().getWorkbook();                FormulaEvaluator evaluator = workbook.getCreationHelper().createFormulaEvaluator();                cellValue = evaluator.evaluate(cell).getNumberValue();                break;            case NUMERIC:                cellValue = cell.getNumericCellValue();                break;            case STRING:                cellValue = cell.getStringCellValue();                break;            case _NONE:            case BLANK:            case ERROR:                break;            default:                break;        }        return cellValue;    }}