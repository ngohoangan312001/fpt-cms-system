var listDataAttendance = [];const formCreateAttendance = document.querySelector('#studentGroupCreate');$(document).ready(function () {    getAllBranchCampusSearchAttendance();    $("#divBranchCampusSearchAttendance").show();    $("#divStudentGroupSearchAttendance").show();    $("#divSemesterSearchAttendance").show();    $("#divSubjectSearchAttendance").show();    $("#divSubjectDateSearchAttendance").show();    $("#divShooseSessionSearchAttendance").show();});$('body').on('click', '#selectall', function () {    $('.singlechkbox').prop('checked', this.checked);});$('body').on('click', '.singlechkbox', function () {    if ($('.singlechkbox').length == $('.singlechkbox:checked').length) {        $('#selectall').prop('checked', true);    } else {        $("#selectall").prop('checked', false);    }});// Search Attendance$("#BranchCampusSearchAttendance").on("change", function () {    $("#StudentGroupSearchAttendance").html('');    $("#SemesterSearchAttendance").html('');    $("#SubjectSearchAttendance").html('');    $("#SubjectDateSearchAttendance").html('');    $("#ShooseSessionSearchAttendance").html('');    getStudentGroupByBranchCampusIdSearchAttendance(($(this).val()).slice(0, ($("#BranchCampusSearchAttendance").val()).indexOf('_')));});$("#StudentGroupSearchAttendance").on("change", function () {    $("#SemesterSearchAttendance").html('');    $("#SubjectSearchAttendance").html('');    $("#SubjectDateSearchAttendance").html('');    $("#ShooseSessionSearchAttendance").html('');    getSemesterByStudentGroupIdSearchAttendance($(this).val());});$("#SemesterSearchAttendance").on("change", function () {    $("#SubjectSearchAttendance").html('');    $("#SubjectDateSearchAttendance").html('');    $("#ShooseSessionSearchAttendance").html('');    getSubjectByStudentGroupIdAndSemsterIdSearchAttendance($("#StudentGroupSearchAttendance").val(), $(this).val());});$("#SubjectSearchAttendance").on("change", function () {    $("#SubjectDateSearchAttendance").html('');    $("#ShooseSessionSearchAttendance").html('');    getSubjectDateByStudentGroupIdAndSemsterIdAndSubjectIdSearchAttendance($("#StudentGroupSearchAttendance").val(), $("#SemesterSearchAttendance").val(), $(this).val());});$("#SubjectDateSearchAttendance").on("change", function () {    $("#ShooseSessionSearchAttendance").html('');    getSession();});// -------------------------------------------------------Search Attendance//Get All Branch Campusfunction getAllBranchCampusSearchAttendance() {    $.ajax({        url: '/api/admin/attendance/getAllBranchCampus',        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            console.log(result);            var option = '<option value="0" selected>--- Select Capmus ---</option>';            for (var i in result) {                option += '<option class="bcSearchAttendance" value="' + result[i].branchcamid + '_' + result[i].branchid + '">' + result[i].branchcamnm + '</option>';            }            $("#BranchCampusSearchAttendance").html(option);        }    });}//Get Student Group By Branch Campus Idfunction getStudentGroupByBranchCampusIdSearchAttendance(branchcampusID) {    $.ajax({        url: '/api/admin/attendance/getStudentGroupByBranchCampusId/' + branchcampusID,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            console.log(result);            var option = '<option value="0" disabled selected>--- Select Student Group ---</option>';            for (var i in result) {                option += '<option class="sgSearchAttendance" value="' + result[i].stugroid + '">' + result[i].stugronm + '</option>';            }            $("#StudentGroupSearchAttendance").html(option);        }    });}//Get Semester By Student Group Idfunction getSemesterByStudentGroupIdSearchAttendance(studentgroupID) {    $.ajax({        url: '/api/admin/attendance/getSemsterByStudentGroupId/' + studentgroupID,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            var option = '<option value="0" disabled selected>--- Select Semester ---</option>';            for (var i in result) {                option += '<option class="semSearchAttendance" value="' + result[i].semid + '">' + result[i].semnm + '</option>';            }            $("#SemesterSearchAttendance").html(option);        }    });}//Get Subject By Semester Id And Student Group Idfunction getSubjectByStudentGroupIdAndSemsterIdSearchAttendance(studentgroupID, semesterID) {    $.ajax({        url: '/api/admin/attendance/getSubjectBySemsterIdAndStudentGroupId/' + studentgroupID + '/' + semesterID,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            var option = '<option value="0" disabled selected>--- Select Subject ---</option>';            for (var i in result) {                option += '<option class="subjectSearchAttendance" value="' + result[i].subjids + '?' + result[i].subjidsd + '">' + result[i].shortnm + ' - ' + result[i].subjnm + '</option>';            }            $("#SubjectSearchAttendance").html(option);        }    });}//Get Subject Date By Semester Id And Student Group Id And Subject Idfunction getSubjectDateByStudentGroupIdAndSemsterIdAndSubjectIdSearchAttendance(studentgroupID, semesterID, subjectID) {    $.ajax({        url: '/api/admin/attendance/getSubjectDateBySemsterIdAndStudentGroupIdAndSubjectId/' + studentgroupID + '/' + semesterID + '/' + subjectID.slice(0, subjectID.indexOf('?')),        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            if (result.length > 0) {                var option = '<option value="0" disabled selected>--- Select Subject Date ---</option>';                for (var i in result) {                    option += '<option class="subjectDateSearchAttendance" value="' + result[i].subjdetailsid + '?' + result[i].subjdate + '">' + result[i].subjdate + '</option>';                }            } else {                var option = '<option value="errorSubjectDateL" disabled selected>--- No Subject Date ---</option>';            }            $("#SubjectDateSearchAttendance").html(option);        }    });}//Get Subject Date By Semester Id And Student Group Id And Subject Idfunction getSession() {    if (($("#SubjectDateSearchAttendance option:selected").val()) == "errorSubjectDateL") {        var option = '<option value="errorSessionL" disabled selected>--- No Session ---</option>';    } else {        var option = '<option value="0" disabled selected>--- Select Session ---</option><option value="S1">Session 1</option><option value="S2">Session 2</option>';    }    $("#ShooseSessionSearchAttendance").html(option);}//Find OptionSessionfunction findOptionSession(studengroupID, semID, subjectID, subjectDate, sessionVal) {    var checkExistS = 0;    $.ajax({        url: '/api/admin/attendance/findCheckExist/' + studengroupID + '/' + semID + '/' + subjectID + '/' + subjectDate + '/' + sessionVal,        type: "GET",        datatype: "JSON",        data: '',        async: false,        success: function (result) {            console.log(result);            if (result != 0) {                checkExistS = result;            }        }    });    return checkExistS;}//Function Create Attendancefunction createAttendance(studengroupID, semID, subjectID) {    $.ajax({        url: '/api/admin/attendance/renderListStudentToCreate/' + studengroupID + '/' + semID + '/' + subjectID,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            var blockTT = '<div class="table-responsive"><table id="tabledb1" class="table table-vcenter table-bordered card-table' +                ' table-striped display"><thead><tr>'                + '<th>No.</th>'                + '<th>Roll Number</th>'                + '<th>Student Name</th>'                + '<th>Student Status</th>'                + '<th><input class="form-check-input" id="selectall" type="checkbox"><span> Attendance </span></th>'                + '<th>Note</th>'                + '</tr></thead><tbody>';            if (Number(result.length) > 0) {                for (var index = 0; index < result.length; index++) {                    blockTT += '<tr><td>' + (index + 1) + '</td>'                        + '<td>' + result[index].rollnum + '</td>'                        + '<td>' + result[index].stunm + '</td>';                    switch (Number(result[index].studentstatus)) {                        case 0:                            blockTT += '<td><span class="badge bg-warning">Current Class</span></td>';                            break;                        case 1:                            blockTT += '<td><span class="badge bg-primary">Learn Again</span></td>';                            break;                    }                    blockTT += '<td><input class="form-check-input singlechkbox" type="checkbox"></td>'                        + '<td><input type="text" class="form-control noteAtt" name="noteAttendance' + (index + 1) + '" placeholder="Note"></td></tr>';                }            } else {                blockTT += '<tr><td colspan="6" style="text-align: center; vertical-align: middle;">No Data</td></tr>';            }            blockTT += '</tbody></table></div>';            blockTT += '<div class="d-flex justify-content-center"><div class="row">'                + '<div class="col-md-3"><button class="btn btn-primary" type="button" onclick="getDataAttendanceInSearchFunction(0)"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9" /><line x1="9" y1="12" x2="15" y2="12" /><line x1="12" y1="9" x2="12" y2="15" /></svg>Save</button></div>'                + '</div></div>';            $("#renderAD").html(blockTT);        }    });}//Function Update Attendancefunction updateAttendance(studengroupID, semID, subjectID, subjectDate, sessionVal) {    $.ajax({        url: '/api/admin/attendance/renderListStudentToUpdate/' + studengroupID + '/' + semID + '/' + subjectID + '/' + subjectDate + '/' + sessionVal,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            var blockTT = '<div class="table-responsive"><table id="tabledb1" class="table table-vcenter table-bordered card-table' +                ' table-striped display"><thead><tr>'                + '<th>No.</th>'                + '<th>Roll Number</th>'                + '<th>Student Name</th>'                + '<th>Student Status</th>'                + '<th><input class="form-check-input" id="selectall" type="checkbox"><span> Attendance </span></th>'                + '<th>Note</th>'                + '</tr></thead><tbody>';            if (Number(result.length) > 0) {                for (var index = 0; index < result.length; index++) {                    blockTT += '<tr><td>' + (index + 1) + '</td>'                        + '<td>' + result[index].rollnum + '</td>'                        + '<td>' + result[index].stunm + '</td>';                    switch (Number(result[index].studentstatus)) {                        case 0:                            blockTT += '<td><span class="badge bg-warning">Current Class</span></td>';                            break;                        case 1:                            blockTT += '<td><span class="badge bg-primary">Learn Again</span></td>';                            break;                    }                    switch (result[index].present) {                        case true:                            blockTT += '<td><input class="form-check-input singlechkbox" type="checkbox" checked></td>';                            break;                        case false:                            blockTT += '<td><input class="form-check-input singlechkbox" type="checkbox" ></td>';                            break;                    }                    blockTT += '<td><input type="text" class="form-control noteAtt" value="' + result[index].note + '" name="noteAttendance' + (index + 1) + '" placeholder="Note">';                    blockTT += '<input type="hidden" class="attenIdHidden" value="' + result[index].attenid + '">';                    blockTT += '</td></tr>';                }            } else {                blockTT += '<tr><td colspan="6" style="text-align: center; vertical-align: middle;">No Data</td></tr>';            }            blockTT += '</tbody></table></div>';            blockTT += '<div class="d-flex justify-content-center"><div class="row">'                + '<div class="col-md-3"><button class="btn btn-primary" type="button" onclick="getDataAttendanceInSearchFunction(1)"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9" /><line x1="9" y1="12" x2="15" y2="12" /><line x1="12" y1="9" x2="12" y2="15" /></svg>Save Changes</button></div>'                + '</div></div>';            $("#renderAD").html(blockTT);        }    });}//Format Datefunction formatDate(date) {    var year = date.getFullYear().toString();    var month = (date.getMonth() + 101).toString().substring(1);    var day = (date.getDate() + 100).toString().substring(1);    return year + "-" + month + "-" + day;}$("#btnSearchAttendance").click(function () {    var branchcampusID = $("#BranchCampusSearchAttendance").val();    var studengroupID = $("#StudentGroupSearchAttendance").val();    var semID = $("#SemesterSearchAttendance").val();    var subjectID = $("#SubjectSearchAttendance").val();    var subjectDate = $("#SubjectDateSearchAttendance").val();    var sessionVal = $("#ShooseSessionSearchAttendance").val();    var today = new Date();    var currentDate = formatDate(new Date(today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate()));    var checkDate = formatDate(new Date($("#SubjectDateSearchAttendance option:selected").text()));    console.log(checkDate + '>' + currentDate);    if (branchcampusID == 0 || studengroupID == 0 || semID == 0 || subjectID == 0 || subjectDate == 0 || sessionVal == 0 || ($("#SubjectDateSearchAttendance option:selected").val()) == "errorSubjectDateL") {        $("#renderAD").html('<div class="d-flex justify-content-center"><h3> No Data </h3></div>');    } else if (($("#SubjectDateSearchAttendance option:selected").val()) != "errorSubjectDateL" && ($("#ShooseSessionSearchAttendance option:selected").val()) == 0) {        console.log("Na Nguyen");        $("#renderAD").html('<div class="d-flex justify-content-center"><h3> Please Select Session </h3></div>');    } else if (checkDate > currentDate) {        console.log("I'm Here");        $("#renderAD").html('<div class="d-flex justify-content-center"><h3> You Do Not Have The Right To Take Attendance Of Students In Class ' + $("#StudentGroupSearchAttendance option:selected").text() + ' </h3></div>');    }    else {        var checkExistS = findOptionSession(studengroupID, semID, subjectID.slice(0, subjectID.indexOf('?')), subjectDate.slice(subjectDate.indexOf('?') + 1), sessionVal);        // console.log('checkExits :>> ' + checkExistS);        console.log(checkExistS);        if (checkExistS == 0) {            console.log("Create Function Admin");            $("#renderAD").html('');            createAttendance(studengroupID, semID, subjectID);        } else {            console.log("Update Function Admin");            $("#renderAD").html('');            updateAttendance(studengroupID, semID, subjectID.slice(0, subjectID.indexOf('?')), subjectDate.slice(subjectDate.indexOf('?') + 1), sessionVal);        }    }});//Find Student Group By Id In Function Updatefunction getDataAttendanceInSearchFunction(optionFunction) {    listDataAttendance = [];    // loop over each table row (tr)    $("#tabledb1 tbody tr").each(function () {        var currentRow = $(this);        var obj = {};        obj.rollnum = currentRow.find("td:eq(1)").text();        obj.stunm = currentRow.find("td:eq(2)").text();        if (currentRow.find(".singlechkbox").is(":checked")) {            obj.present = true;        } else {            obj.present = false;        }        obj.note = currentRow.find(".noteAtt").val();        // Use Search        obj.branchcamid = ($("#BranchCampusSearchAttendance").val()).slice(0, ($("#BranchCampusSearchAttendance").val()).indexOf('_'));        obj.studentgroupid = $("#StudentGroupSearchAttendance").val();        obj.semid = $("#SemesterSearchAttendance").val();        obj.subjectid = ($("#SubjectSearchAttendance").val()).slice(0, ($("#SubjectSearchAttendance").val()).indexOf('?'));        obj.subjectdetailsid = ($("#SubjectSearchAttendance").val()).slice(($("#SubjectSearchAttendance").val()).indexOf('?') + 1);        obj.subjdate = ($("#SubjectDateSearchAttendance").val()).slice(($("#SubjectDateSearchAttendance").val()).indexOf('?') + 1);        obj.session = $("#ShooseSessionSearchAttendance").val();        // Use Update Function        obj.attenid = currentRow.find(".attenIdHidden").val();        listDataAttendance.push(obj);    });    selectFunctionAndExecute(optionFunction);}function selectFunctionAndExecute(optionFunction) {    switch (optionFunction) {        case 0:            console.log("Execute Create Function");            console.log(listDataAttendance);            $.ajax({                type: 'POST',                url: '/api/admin/attendance/createAttendance',                data: JSON.stringify(listDataAttendance),                dataType: 'json',                contentType: 'application/json',                success: function (result) {                    Swal.fire({                        position: 'center',                        icon: 'success',                        title: 'Successful Attendance',                        showConfirmButton: false,                        timer: 1000                    });                    setTimeout("location.reload(true);", 1000);                },                error: function () {                    Swal.fire({                        position: 'center',                        icon: 'error',                        title: 'Error',                        showConfirmButton: false,                        timer: 1000                    });                }            });            break;        case 1:            console.log("Execute Update Function");            console.log(listDataAttendance);            $.ajax({                type: 'POST',                url: '/api/admin/attendance/updateAttendance',                data: JSON.stringify(listDataAttendance),                dataType: 'json',                contentType: 'application/json',                success: function (result) {                    Swal.fire({                        position: 'center',                        icon: 'success',                        title: 'Save Changes Successfully',                        showConfirmButton: false,                        timer: 1000                    });                    setTimeout("location.reload(true);", 1000);                },                error: function () {                    Swal.fire({                        position: 'center',                        icon: 'error',                        title: 'Error',                        showConfirmButton: false,                        timer: 1000                    });                }            });            break;    }}