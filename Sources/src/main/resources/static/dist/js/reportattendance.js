$(document).ready(function () {    getAllBranchCampusSearchAttendance();});// Search Attendance$("#BranchCampusSearchAttendance").on("change", function () {    $("#StudentGroupSearchAttendance").val(0);    $("#SemesterSearchAttendance").val(0);    $("#SubjectSearchAttendance").val(0);    getStudentGroupByBranchCampusIdSearchAttendance(($(this).val()).slice(0, 1));});$("#StudentGroupSearchAttendance").on("change", function () {    $("#SemesterSearchAttendance").val(0);    $("#SubjectSearchAttendance").val(0);    getSemesterByStudentGroupIdSearchAttendance($(this).val());});$("#SemesterSearchAttendance").on("change", function () {    $("#SubjectSearchAttendance").val(0);    getSubjectByStudentGroupIdAndSemsterIdSearchAttendance($("#StudentGroupSearchAttendance").val(), $(this).val());});//Get All Branch Campusfunction getAllBranchCampusSearchAttendance() {    $.ajax({        url: '/api/admin/attendance/getAllBranchCampus',        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            console.log(result);            var option = '<option value="0" selected>--- Select Capmus ---</option>';            for (var i in result) {                option += '<option class="bcSearchAttendance" value="' + result[i].branchcamid + '_' + result[i].branchid + '">' + result[i].branchcamnm + '</option>';            }            $("#BranchCampusSearchAttendance").html(option);        }    });}//Get Student Group By Branch Campus Idfunction getStudentGroupByBranchCampusIdSearchAttendance(branchcampusID) {    $.ajax({        url: '/api/admin/attendance/getStudentGroupByBranchCampusId/' + branchcampusID,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            console.log(result);            var option = '<option value="0" selected>--- Select Student Group ---</option>';            for (var i in result) {                option += '<option class="sgSearchAttendance" value="' + result[i].stugroid + '">' + result[i].stugronm + '</option>';            }            $("#StudentGroupSearchAttendance").html(option);        }    });}//Get Semester By Student Group Idfunction getSemesterByStudentGroupIdSearchAttendance(studentgroupID) {    $.ajax({        url: '/api/admin/attendance/getSemsterByStudentGroupId/' + studentgroupID,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            console.log(result);            var option = '<option value="0" selected>--- Select Semester ---</option>';            for (var i in result) {                option += '<option class="semSearchAttendance" value="' + result[i].semid + '">' + result[i].semnm + '</option>';            }            $("#SemesterSearchAttendance").html(option);        }    });}//Get Subject By Semester Id And Student Group Idfunction getSubjectByStudentGroupIdAndSemsterIdSearchAttendance(studentgroupID, semesterID) {    $.ajax({        url: '/api/admin/attendance/getSubjectBySemsterIdAndStudentGroupId/' + studentgroupID + '/' + semesterID,        type: "GET",        datatype: "JSON",        data: '',        success: function (result) {            console.log(result);            var option = '<option value="0" selected>--- Select Capmus ---</option>';            for (var i in result) {                option += '<option class="subjectSearchAttendance" value="' + result[i].subjids +'?'+ result[i].subjidsd + '">' + result[i].shortnm + ' - ' + result[i].subjnm + '</option>';            }            $("#SubjectSearchAttendance").html(option);        }    });}// var listSubjectDate = [];//Get Subject Date By Semester Id And Student Group Id And Subject Idfunction getSubjectDateByStudentGroupIdAndSemsterIdAndSubjectIdSearchAttendance(studentgroupID, semesterID, subjectID) {    var listSubjectDate = [];    $.ajax({        url: '/api/admin/attendance/getSubjectDateBySemsterIdAndStudentGroupIdAndSubjectId/' + studentgroupID + '/' + semesterID + '/' + subjectID.slice(0, subjectID.indexOf('?')),        type: "GET",        datatype: "JSON",        data: '',        async: false,        success: function (result) {            for (var i = 0; i < result.length; i++){                listSubjectDate.push(result[i].subjdate);            }        }    });    return listSubjectDate;}$("#btnSearchAttendanceReport").click(function () {    var studengroupID = $("#StudentGroupSearchAttendance").val();    var semID = $("#SemesterSearchAttendance").val();    var subjectID = $("#SubjectSearchAttendance").val();    var listSubjectDate = getSubjectDateByStudentGroupIdAndSemsterIdAndSubjectIdSearchAttendance(studengroupID, semID, subjectID);    //console.log(listSubjectDate);    $.ajax({        url: '/api/admin/attendance/renderAttendanceReport/' + studengroupID + '/' + semID + '/' + subjectID,        type: "GET",        datatype: "JSON",        data: '',        async: false,        success: function (result) {            var blockTT = '<div class="table-responsive"><table id="tabledb1" class="table table-vcenter table-bordered card-table' +                ' table-striped display"><thead><tr>'                + '<th rowspan="2">Rollnum</th>'                + '<th rowspan="2" width="150px">Student Name</th>'            for (var i = 0; i < listSubjectDate.length; i++) {                blockTT += '<th colspan="2">' + listSubjectDate[i] + '</th>'            }            blockTT += '<th rowspan="2">Percent %</th>'            blockTT += '</tr>'            blockTT += '<tr>'            for (var i = 0; i < listSubjectDate.length; i++) {                blockTT += '<th> Session 1 </th>'                blockTT += '<th> Session 2 </th>'            }            blockTT += '</tr></thead>'            var countStu = 0;            var countPresent = 0;            var countAbsent = 0;            var countNotyet = 0;            var lastRecord = result.length - 1;            blockTT += '<tbody>'            for (var i = 0; i < result.length; i++) {                if (i == 0 || (result[i].rollnum != result[i - 1].rollnum)) {                    if (i != 0) {                        if (countStu != listSubjectDate.length * 2){                            const totalNotyet = (listSubjectDate.length * 2) - countStu;                            for (var j = 0; j < totalNotyet; j++) {                                blockTT += '<td class="text-azure"> <b>Not Yet</b> </td>';                                countNotyet++;                                //countStu++;                            }                        }                        blockTT += '<td>' + Math.trunc((countPresent * 100) / (countAbsent + countPresent + countNotyet)) + '%</td>'                        blockTT += '</tr>'                        countStu = 0;                        countPresent = 0;                        countNotyet = 0;                        countAbsent = 0;                    }                    blockTT += '<tr>'                        + '<td>' + result[i].rollnum + '</td>'                        + '<td>' + result[i].fullnm + '</td>';                    if (result[i].present === true) {                        blockTT += '<td class="text-green"> <b>P</b> </td>';                        countPresent++;                    } else {                        blockTT += '<td class="text-danger"> <b>A</b> </td>';                        countAbsent++;                    }                    countStu++;                } else {                    if (result[i].present === true) {                        blockTT += '<td class="text-green"> <b>P</b> </td>';                        countPresent++;                    } else {                        blockTT += '<td class="text-danger"> <b>A</b> </td>';                        countAbsent++;                    }                    countStu++;                    // console.log(result[i].present);                }                if (i == lastRecord){                    if (countStu != listSubjectDate.length * 2){                        const totalNotyet = (listSubjectDate.length * 2) - countStu;                        for (var j = 0; j < totalNotyet; j++) {                            blockTT += '<td class="text-azure"> Not Yet </td>';                            countNotyet++;                            //countStu++;                        }                    }                    blockTT += '<td>' + Math.trunc((countPresent * 100) / (countAbsent + countPresent + countNotyet)) + '%</td>'                    blockTT += '</tr>'                    countStu = 0;                    countPresent = 0;                    countNotyet = 0;                    countAbsent = 0;                }                // if (countStu === listSubjectDate.length) {                //     //blockTT += '</tr>';                //     //countStu = 0;                // }                //blockTT += '</tr>'            }            blockTT += '</tbody></table>';            $("#renderAD").html(blockTT);        }    });});